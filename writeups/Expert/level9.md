# Level 9 Writeup — IP 封禁的防护缺陷

## 关卡目标
- 绕过基于 IP 的封禁与限速策略。

## 场景概览
- 登录入口：`Expert/level9/login.html`
- 登录后端：`Expert/level9/login.php`
- 黑名单/计数：`Expert/level9/ip-block.json`
- 登录成功页：`Expert/level9/welcome.html`

## 核心缺陷
- 信任可伪造的来源头（如 `X-Forwarded-For`），或仅按 IP 维度计数，导致轻易绕过。

## 攻击步骤
1. 在请求中伪造或轮换 `X-Forwarded-For` 值规避封禁。
2. 使用代理池或多头部组合测试封禁策略的边界。

## 验证点与证据
- 观察计数文件或后台日志中的 IP 记录变化；确认封禁未生效。

## 修复建议
- 在可信代理层处理并擦除不可信头；服务端仅信任基础连接 IP 或代理注入的标准头。
- 多维度限速（IP+账户+设备指纹），并引入行为风控。

## 教学提示
- 单一维度的限速/封禁容易被绕过，头部信任是重点风险。